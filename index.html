<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Blockly Only</title>
    <script src="https://unpkg.com/blockly/blockly.min.js"></script>
    <script src="https://unpkg.com/blockly/javascript_compressed.js" defer></script>
    <script src="https://unpkg.com/blockly/python_compressed.js" defer></script>
    <script src="https://unpkg.com/blockly/dart_compressed.js" defer></script>
    <script src="https://unpkg.com/blockly/lua_compressed.js" defer></script>
    <script src="https://unpkg.com/blockly/php_compressed.js" defer></script>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        #blocklyDiv {
            height: 100%;
            width: 100%;
        }
    </style>
</head>
<body>
<div id="blocklyDiv"></div>

<xml id="toolbox" style="display: none">
    <category name="Logic" colour="%{BKY_LOGIC_HUE}">
        <block type="controls_if"></block>
    </category>
    <category name="Loops" colour="%{BKY_LOOPS_HUE}">
        <block type="controls_repeat_ext"></block>
    </category>
    <category name="Math" colour="%{BKY_MATH_HUE}">
        <block type="math_number"></block>
    </category>
    <category name="Text" colour="%{BKY_TEXTS_HUE}">
        <block type="text"></block>
    </category>
</xml>

<script>
    window.addEventListener('load', () => {
        Blockly.inject('blocklyDiv', {
            toolbox: document.getElementById('toolbox'),
            grid: {
                spacing: 20,
                length: 3,
                colour: '#ccc',
                snap: true
            },
            trashcan: true,
            zoom: {
                controls: true,
                wheel: true
            }
        });
    });
</script>

<!-- ✅ 커스텀 prompt/confirm/alert 오버라이드 -->
<script id="blockly-dialog-override">
    (function () {
        function showPromptModal(message, defaultValue, onDone) {
            const overlay = document.createElement('div');
            overlay.style.position = 'fixed';
            overlay.style.inset = '0';
            overlay.style.background = 'rgba(0,0,0,.35)';
            overlay.style.zIndex = 9998;

            const modal = document.createElement('div');
            modal.style.position = 'fixed';
            modal.style.top = '50%';
            modal.style.left = '50%';
            modal.style.transform = 'translate(-50%, -50%)';
            modal.style.backgroundColor = '#fff';
            modal.style.border = '2px solid #5C81A6';
            modal.style.borderRadius = '10px';
            modal.style.padding = '20px';
            modal.style.zIndex = 9999;
            modal.style.boxShadow = '0 4px 12px rgba(0,0,0,0.2)';
            modal.style.fontFamily = 'Arial, sans-serif';
            modal.style.minWidth = '320px';
            modal.style.maxWidth = '90vw';

            const label = document.createElement('div');
            label.textContent = message || '';
            label.style.marginBottom = '10px';

            const input = document.createElement('input');
            input.value = defaultValue || '';
            input.style.width = '100%';
            input.style.padding = '10px';
            input.style.marginBottom = '12px';
            input.style.border = '1px solid #ccc';
            input.style.borderRadius = '6px';
            input.style.fontSize = '16px';

            const btnRow = document.createElement('div');
            btnRow.style.display = 'flex';
            btnRow.style.gap = '8px';
            btnRow.style.justifyContent = 'flex-end';

            const okButton = document.createElement('button');
            okButton.textContent = '확인';
            okButton.style.padding = '8px 14px';
            okButton.style.backgroundColor = '#5C81A6';
            okButton.style.color = '#fff';
            okButton.style.border = 'none';
            okButton.style.borderRadius = '6px';
            okButton.style.cursor = 'pointer';

            const cancelButton = document.createElement('button');
            cancelButton.textContent = '취소';
            cancelButton.style.padding = '8px 14px';
            cancelButton.style.backgroundColor = '#ccc';
            cancelButton.style.border = 'none';
            cancelButton.style.borderRadius = '6px';
            cancelButton.style.cursor = 'pointer';

            function cleanupAndReturn(val) {
                try {
                    document.body.removeChild(modal);
                } catch {
                }
                try {
                    document.body.removeChild(overlay);
                } catch {
                }
                onDone(val);
            }

            okButton.onclick = () => cleanupAndReturn(String(input.value));
            cancelButton.onclick = () => cleanupAndReturn(null);
            overlay.onclick = () => cleanupAndReturn(null);

            modal.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    okButton.click();
                }
                if (e.key === 'Escape') {
                    e.preventDefault();
                    cancelButton.click();
                }
            });

            btnRow.appendChild(cancelButton);
            btnRow.appendChild(okButton);
            modal.appendChild(label);
            modal.appendChild(input);
            modal.appendChild(btnRow);

            document.body.appendChild(overlay);
            document.body.appendChild(modal);
            input.focus();
            input.select();
        }

        function installBlocklyDialogs() {
            if (!window.Blockly || !Blockly.dialog) return false;
            Blockly.dialog.setPrompt(function (message, defaultValue, callback) {
                showPromptModal(message, defaultValue, callback);
            });
            Blockly.dialog.setConfirm(function (message, callback) {
                const ok = window.confirm(message || '');
                callback(!!ok);
            });
            Blockly.dialog.setAlert(function (message, opt_callback) {
                window.alert(message || '');
                if (opt_callback) opt_callback();
            });
            return true;
        }

        (function wait() {
            if (!installBlocklyDialogs()) {
                setTimeout(wait, 0);
            }
        })();
    })();
</script>

<!-- Flutter 로딩용 -->
<script src="flutter_bootstrap.js" async></script>
</body>
</html>
