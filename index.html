<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"/>
    <title>Blockly Java í…ŒìŠ¤íŠ¸</title>
    <script src="https://unpkg.com/blockly/blockly.min.js"></script>
    <!-- JavaScript Generator ëŒ€ì‹  JavaGeneratorë¥¼ ì§ì ‘ ë¡œë“œí•œ ìƒíƒœë¼ê³  ê°€ì • -->
    <script src="java_compressed.js"></script> <!-- ë„ˆê°€ ë§Œë“  Java generator js ë¹Œë“œ ê²°ê³¼ -->
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        #blocklyDiv {
            height: 100%;
            width: 100%;
        }
    </style>
</head>
<body>

<div id="blocklyDiv"></div>

<script>
    // ğŸ§± Toolbox (ìŠ¤í¬ë˜ì¹˜ ìŠ¤íƒ€ì¼)
    const toolbox = {
        "kind": "categoryToolbox",
        "contents": [
            {
                "kind": "category",
                "name": "ì œì–´",
                "categorystyle": "loop_category",
                "contents": [
                    {"kind": "block", "type": "controls_repeat_ext"},
                    {"kind": "block", "type": "controls_whileUntil"}
                ]
            },
            {
                "kind": "category",
                "name": "ìˆ˜í•™",
                "categorystyle": "math_category",
                "contents": [
                    {"kind": "block", "type": "math_number"},
                    {"kind": "block", "type": "math_arithmetic"}
                ]
            },
            {
                "kind": "category",
                "name": "ë³€ìˆ˜",
                "custom": "VARIABLE"
            }
        ]
    };

    // ğŸ§± ìë°” ì½”ë“œ í…ŒìŠ¤íŠ¸ìš© ë¸”ëŸ­(XML)
    const testXml = `
  <xml xmlns="https://developers.google.com/blockly/xml">
    <block type="math_number" x="40" y="40">
      <field name="NUM">99</field>
    </block>
    <block type="controls_repeat_ext" x="40" y="140">
      <value name="TIMES">
        <shadow type="math_number">
          <field name="NUM">3</field>
        </shadow>
      </value>
      <statement name="DO">
        <block type="math_change">
          <field name="VAR">i</field>
          <value name="DELTA">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
        </block>
      </statement>
    </block>
  </xml>
  `;

    // ğŸ§± Java generator ì¸ìŠ¤í„´ìŠ¤ ì£¼ì…
    // âš ï¸ ì•„ë˜ ì¤„ì—ì„œ javaGeneratorëŠ” ë„¤ê°€ ë§Œë“  ëª¨ë“ˆì´ exportí•œ ë³€ìˆ˜ì—¬ì•¼ í•¨
    Blockly.Java = javaGenerator;

    const workspace = Blockly.inject('blocklyDiv', {
        toolbox: toolbox,
        scrollbars: true,
        trashcan: true
    });

    // ë¸”ëŸ­ ì‚½ì…
    const xml = Blockly.Xml.textToDom(testXml);
    Blockly.Xml.domToWorkspace(xml, workspace);

    // âœ… Flutter í˜¸ì¶œìš© í•¨ìˆ˜
    function getGeneratedCode() {
        const code = Blockly.Java.workspaceToCode(workspace);
        if (window.FlutterChannel) {
            window.FlutterChannel.postMessage(code);
        }
        return code;
    }

    // âœ… Flutter â†’ JS í˜¸ì¶œ í…ŒìŠ¤íŠ¸ìš© (ì½˜ì†”ì—ì„œë„ ê°€ëŠ¥)
    window.getGeneratedCode = getGeneratedCode;

</script>

</body>
</html>
